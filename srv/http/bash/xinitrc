#!/bin/bash

export XDG_CACHE_HOME="/tmp/.cache"

file=/srv/http/data/system/localbrowser.conf
if [[ -e $file ]]; then
	. $file
else
	screenoff=0
	cursor=false
	zoom=1
fi

xset dpms $screenoff $screenoff $screenoff
if (( $screenoff == 0 )); then
	xset s off
	xset -dpms
fi

if [[ $cursor == false ]] && ifconfig | grep -A1 'eth0\|wlan0' | grep -q inet; then
	cursor=no
else 
	cursor=yes
fi
matchbox-window-manager -use_cursor $cursor &

if [[ -e /usr/bin/firefox ]]; then
	dirfirefox=/root/.mozilla/firefox
	profile=$( grep Default $dirfirefox/installs.ini | cut -d= -f2 )
	echo 'user_pref("layout.css.devPixelsPerPx", "'$zoom'");' > $dirfirefox/$profile/user.js
	firefox -kiosk http://localhost
else
	chromium localhost --kiosk --incognito --no-sandbox --no-xshm --force-device-scale-factor=$zoom
fi

#chromium localhost --kiosk --incognito --no-sandbox --no-xshm --force-device-scale-factor=$zoom
#midori -e Fullscreen -a http://localhost
#firefox -kiosk http://localhost
